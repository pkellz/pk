<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="format-detection" content="telephone=no">
        <title>NPS Survey</title>
        <link rel="stylesheet" href="rating.css">
    </head>
    <body>

        <main id="main" class="main" role="main">
            <form id="init-form">
                <h4>Would like to give Zinio a 5-star rating?</h4>
                <input type="radio" name="opt" value="yes">
                <label for="yes">Yes</label>

                <input type="radio" name="opt" value="no">
                <label for="no">No</label>
                <input type="submit" class="button" value="Submit">
            </form>
            <form name="form" id="page-rate">
                <div class="logo"><img src="https://placeholdit.imgix.net/~text?txtsize=23&bg=333333&txtclr=ffffff&txt=Logo%20Here&w=250&h=100" width="250" /></div>

            	<h1>What do you think?</h1>
                <h2>How likely is it that you would recommend our App to a friend or colleague?</h2>

                <div class="rating-elements">
                    <ul id="slide-indicator" class="clear-float">
                      <li class="item-0"><span>0</span></li>
                      <li class="item-1"><span>1</span></li>
                      <li class="item-2"><span>2</span></li>
                      <li class="item-3"><span>3</span></li>
                      <li class="item-4"><span>4</span></li>
                      <li class="item-5"><span>5</span></li>
                      <li class="item-6"><span>6</span></li>
                      <li class="item-7"><span>7</span></li>
                      <li class="item-8"><span>8</span></li>
                      <li class="item-9"><span>9</span></li>
                    </ul>

                    <div id="count" class="noUiSlider"></div>

                    <p class="not-label">Not at all likely</p>
                    <p class="very-label">Extremely likely</p>

                    <div class="user-rating">
                        <span class="small-text">My Rating:</span>
                        <div id="current-value">?</div>
                    </div>
                </div>

                <input type="submit" class="button" value="Submit">
            </form>

            <form name="form3" id="page-thankyou">
            	<div class="yourapp">App Name</div>
                <h1>Thanks!</h1>
                <p>Your feedback will help create a<br />better experience.</p>
                <input type="submit" class="button close" value="Close"/>
            </form>

            <div id="page-rate-us" class="page">
            	<div class="yourapp">App Name</div>
                <h1>Thanks!</h1>
                <p>If you're enjoying the App Name, please take a moment to rate us in the App Store and help others to discover what we have to offer.</p>
                <a href="https://itunes.apple.com/us/genre/ios/id36?mt=8" class="button">Rate the App</a>
                <a href="zinio://zinio.com/rate" class="button">Rate the App</a>

            </div>

            <form name="form" id="page-feedback">
            	<h1>We Value Your Feedback</h1>
				<!-- Insert text for users to select if they are Neutral or Detractor --><!-- Insert text for users to select if they are Neutral or Detractor -->
                <label>How do you think we could improve?</label>
                <select name="how" id="improve_option" class="replace-select options">
                    <option value="0">Choose one</option>
                    <option value="1">Add support for ...</option>
                    <option value="2">Expand ... features</option>
                    <option value="3">Improve ...</option>
                    <option value="4">Decrease ...</option>
                    <option value="5">Other</option>
                </select>

                <label>Care to provide details?</label>
                <textarea maxlength='250' id="details_text"></textarea>

                <input type="submit" class="button" value="Submit">
            </form>

        </main>
        <!-- / main -->
<!--
DO NOT CHANGE ANYTHING BELOW THIS LINE
-->
        <script src="jquery-1.9.1.min.js"></script>
        <script src="jquery.nouislider.js"></script>
        <script>
            (function($){
                var rating = $('#count'),
                    rateIndicator = $('#current-value'),
                    slideIndicator = $('#slide-indicator'),
                    indicatorNumbers = slideIndicator.find('li'),
                    pageRate = $('#page-rate'),
                    pageRateUs = $('#page-rate-us'),
                    pageFeedback = $('#page-feedback'),
                    pageThankYou = $('#page-thankyou'),
                    ratingValue = 5,
                // pkellz
                    initForm = $('#init-form'),
                    radioGroup = $("input[type='radio']"),
                    yesRadio = radioGroup[0],
                    noRadio = radioGroup[1]
          
                initForm.on('submit',function(e)
                {
                  e.preventDefault();
                  $(this).hide()
                  if(noRadio.checked && !yesRadio.checked) pageFeedback.show()

                  else if(!noRadio.checked && yesRadio.checked) window.location.href="zinio://zinio.com/rate"

                  else $(this).show()
                })
                // end pkellz

                pageRate.on('submit', function(e) {
                    e.preventDefault();

                    $(this).hide();

                    if(ratingValue < 8) {
                        pageFeedback.show();
                    } else {
                        pageRateUs.show();
                        formSubmit();
                    }
                    return false;
                });

                pageRateUs.on('submit',  function(e) {
                    e.preventDefault();
                });

                pageFeedback.on('submit', function(e) {
                    e.preventDefault();
                    formSubmit();

                    $(this).hide();
                    pageThankYou.show();
                });
//TODO - not important to me
                function onRatingSliderChange(value) {
                    rateIndicator.text(value);

                    indicatorNumbers.each(function(i){
                        $(this).toggleClass('active', i < value);
                    });
                }

                function formSubmit() {
                    if (typeof(localytics) === "undefined") {
                        return;
                    }
                    var attributes = {};
                    if (ratingValue >= 9) {
                        attributes["rating"] = "Promoter";
                        if (typeof(localytics.setProfileAttribute) === "function") {
                            localytics.setProfileAttribute("Net Promoter Score", "Promoter");
                        }
                    } else if (ratingValue <= 6) {
                        attributes["rating"] = "Detractor";
                        if (typeof(localytics.setProfileAttribute) === "function") {
                            localytics.setProfileAttribute("Net Promoter Score", "Detractor");
                        }
                    } else {
                        attributes["rating"] = "Neutral";
                        if (typeof(localytics.setProfileAttribute) === "function") {
                            localytics.setProfileAttribute("Net Promoter Score", "Neutral");
                        }
                    }
                    attributes["raw rating"] = ratingValue;
                    attributes["improve option"] = $('#improve_option option:selected').text();
                    attributes['details text'] = $('#details_text').val();
                    if (typeof(localytics.campaign) !== "undefined") { //on SDK 4.3 we know the campaign ID
                        attributes['campaign'] = localytics.campaign.campaignId;
                    } else {
                        attributes['campaign'] = "cpp_12345678"; //needs to be changed to app campaign number
                    }

                    localytics.tagEvent("In-App Rating Result", attributes);
                    if (typeof(localytics.tagClickEvent) === "function") {
                        localytics.tagClickEvent();
                    }
					// Set Custom Dimension ID to a key not currently set. Use a recognizable dimension name.
                    localytics.setCustomDimension (0, attributes["NPS rating"]);
                }

                function initCloseButton() {
                    $('.button.close').click(function(e){
                        e.preventDefault();
                        localytics.close();
                    });
                }

                function replaceSelect() {
                    $('.replace-select').each(function() {
                        $(this).wrap('<div class="custom-select-container" />');

                        var span = $('<span class="custom-select" aria-hidden="true">' + $('option:selected', this).text() + '</span>');
                        $(this).after(span);

                        var update = function() {
                            val = $('option:selected', this).text();
                            span.text(val);
                        };

                        $(this).change(update);
                        $(this).keyup(update);

                        var additionalClass = $(this).attr('data-customselect-addclass');
                        span.addClass(additionalClass);

                        $(this).bind({
                            mouseenter: function() {span.addClass('hover');},
                            mouseleave: function() {span.removeClass('hover');},
                            focus: function() {span.addClass('active').removeClass('hover');},
                            blur: function() {span.removeClass('active');}
                        });
                    });
                }

                function createSlider() {
                    $("#count").noUiSlider({
                        range: [0, 10]
                       ,start: ratingValue
                       ,handles: 1
                       ,step: 1
                       ,slide: function(){
                            ratingValue = $(this).val();
                            onRatingSliderChange(ratingValue);
                       }
                    });
                }

                onRatingSliderChange(ratingValue);
                createSlider();
                replaceSelect();
                initCloseButton();

            })(jQuery);
        </script>
    </body>
</html>
